---
layout: default
title: (leetcode307)Range Sum Query - Mutable
---

<h2>{{ page.title }}</h2>
<p>采用了一种之前自己并不知道的数据结构，线段树</p>
{% highlight ruby %} 
class SegmentTreeNode{ 
	int start,end;
	SegmentTreeNode left;
	SegmentTreeNode right;
	int sum;	
	
	public SegmentTreeNode(int start,int end){
		this.start=start;
		this.end=end;
	}
}

class SegmentTree{
	
	private int[] nums=null;
	private SegmentTreeNode root=null;
	
	public SegmentTree(int[] nums){
		this.nums=nums;
		root=buildTree(0,nums.length-1);
	}
	
	public SegmentTreeNode buildTree(int start,int end){
		SegmentTreeNode root=new SegmentTreeNode(start,end);
		if(start==end)
			root.sum=nums[start];
		else
		{
			int mid=start+(end-start)/2;
			root.left=buildTree(start,mid);
			root.right=buildTree(mid+1,end);
			root.sum=root.left.sum+root.right.sum;			
		}
		return root;
	}
	
	public int sumRange(int pos,SegmentTreeNode root){
		int start=root.start, end=root.end;
		int mid=start+(end-start)/2;
		int sum=0;
		if(pos==end)
			return root.sum;
		if(pos>mid)
		{
			sum+=root.left.sum;	
			sum+=sumRange(pos,root.right);
		}
		else
		{
			sum+=sumRange(pos,root.left);
		}
		return sum;		
	}
	
	public int sumRange(int pos){
		return sumRange(pos,root);
	}
	
	public void update(int i,int val){
		int len=val-nums[i];
		nums[i]=val;
		update(i,len,root);
	}
	
	public void update(int pos,int len,SegmentTreeNode root){
		int mid=root.start+(root.end-root.start)/2;
		root.sum+=len;
		if(root.start==root.end)
			return ;
			
		if(pos>mid)
			update(pos,len,root.right);
		else
			update(pos,len,root.left);
		
	}
	
}

public class NumArray {
	
	private SegmentTree root=null;

    public NumArray(int[] nums) {
        if(nums!=null&&nums.length>0)
    	    root=new SegmentTree(nums);
    }

    void update(int i, int val) {
        if(root==null)
            return ;
        root.update(i, val);
    }

    public int sumRange(int i, int j) {
        if(root==null)
        return 0;
    	if(i>0)
    		return root.sumRange(j)-root.sumRange(i-1);
    	return root.sumRange(j);
    }
}
{% endhighlight %}
<p>{{ page.date | date_to_string }}</p>